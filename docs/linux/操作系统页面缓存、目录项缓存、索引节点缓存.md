# 操作系统页面缓存、目录项缓存、索引节点缓存

## 页面缓存、目录项缓存、索引节点缓存原理

操作系统中的页面缓存（Page Cache）、目录项缓存（Dentry Cache）和索引节点缓存（Inode Cache）是提升系统性能和效率的关键机制。以下是关于这三种缓存的详细解释：

1. **页面缓存（Page Cache）**

   **定义与功能**：
   页面缓存是操作系统内核管理的一部分，用于将频繁访问的数据从磁盘存储到内存中，以便更快地访问。当程序从磁盘请求数据时，操作系统会首先检查这些数据是否已存在于页面缓存中。如果存在，则直接从内存中读取，这比从磁盘访问要快得多。如果数据不在缓存中，操作系统会从磁盘中读取数据并将其存储在缓存中以供将来使用。

   **工作原理**：

   - 当应用程序打开一个文件并读取其中的数据时，操作系统会将文件的内容读取到内存中，并将其缓存为一个或多个页（通常是4KB大小的页）。
   - 这些缓存的页被存储在一个被称为Page Cache的内存区域中。
   - 当应用程序再次访问相同的文件时，操作系统会检查Page Cache中是否存在这些页的副本。如果存在，则直接从Page Cache中返回数据，而不需要再次访问磁盘。
   - 如果应用程序对文件进行写操作，数据会被写入到Page Cache中的脏页（dirty page）。脏页表示该页的内容已经被修改，但还没有写回到磁盘。
   - 当系统内存压力较大或需要释放内存时，内核会触发缓存刷新操作，将脏页从Page Cache写回到磁盘中。

   **重要性**：

   - 页面缓存通过减少对硬盘的直接访问，显著降低了I/O等待时间，从而提高了应用程序的响应速度和系统整体性能。
   - 它还优化了系统资源的利用，确保内存和磁盘资源的高效使用。

2. **目录项缓存（Dentry Cache）**

   **定义与功能**：
   目录项缓存是内核维护的内存数据结构，用于缓存磁盘上的目录项信息。目录项是文件系统中用于表示文件和目录的数据结构，它包含了文件名、inode（索引节点）指针等信息。目录项缓存的目的是提高从文件名到文件数据的查找速度。

   **工作原理**：

   - 当进程需要访问某个文件时，操作系统会首先在目录项缓存中查找该文件的目录项。
   - 如果找到，则直接通过目录项中的inode指针访问文件数据，而无需再次从磁盘中读取目录项信息。
   - 如果未找到，操作系统会从磁盘中读取目录项信息并将其添加到目录项缓存中。

   **重要性**：

   - 目录项缓存减少了磁盘I/O操作，提高了文件系统的访问速度。
   - 它还减少了CPU的查找时间，因为内存访问速度远快于磁盘访问速度。

3. **索引节点缓存（Inode Cache）**

   **定义与功能**：
   索引节点（Inode）是Linux文件系统中的核心数据结构，用于存储文件的元数据（如文件大小、创建时间、修改时间、权限等）。索引节点缓存则是将这些inode信息缓存在内存中，以便快速访问。

   **工作原理**：

   - 当文件被访问时，操作系统会首先检查inode缓存中是否存在该文件的inode信息。
   - 如果存在，则直接读取inode信息以获取文件的元数据。
   - 如果不存在，操作系统会从磁盘中读取inode信息并将其添加到inode缓存中。

   **重要性**：

   - 索引节点缓存减少了对磁盘的访问次数，提高了文件系统的整体性能。
   - 它还使得对文件属性的修改（如修改时间戳）能够更快地反映在文件系统中。

   综上所述，页面缓存、目录项缓存和索引节点缓存都是操作系统中用于提升性能和效率的重要机制。它们通过减少磁盘I/O操作、提高内存访问速度和优化系统资源利用来增强系统的整体性能。



## 清除页面缓存

- `centOS8`清除页面缓存

  ```bash
  sync; echo 1 > /proc/sys/vm/drop_caches
  ```

- `ubuntu`清楚页面缓存

  ```bash
  # 登录到root用户，否则会报告permission denied错误
  sudo -i
  
  sync; echo 1 > /proc/sys/vm/drop_caches
  ```



## 查看页面缓存命中率

通过`cachestat`或者`cachetop`命令查看页面缓存命中率。

`todo`：安装`cachestat`或者`cachetop`命令步骤麻烦，暂时不研究。