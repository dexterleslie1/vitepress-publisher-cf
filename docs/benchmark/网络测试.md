# 网络性能测试

## 使用`iperf3`测试网络性能

>参考 [链接](https://www.linode.com/docs/networking/diagnostics/diagnosing-network-speed-with-iperf)

网卡出入流量吞吐量测试

- 启动服务端，`-f M`表示使用`MB`为单位显示结果，`-i 5`表示每5秒输出一次测试报告

  ```bash
  iperf3 -s -f M -i 5
  ```

- 启动客户端进行单向传输测试，其中`192.168.235.147`是服务端虚拟机`ip`地址，`-f M`表示使用`MB`为单位显示结果，`-i 5`表示每5秒输出一次测试报告，`-t 30`表示持续测试30秒

  ```bash
  iperf3 -c 192.168.235.147 -f M -t 30 -i 5
  ```

`iperf3`测试报告解析：

```bash
Connecting to host 192.168.235.147, port 5201
[  5] local 192.168.235.145 port 55996 connected to 192.168.235.147 port 5201
[ ID] Interval           Transfer     Bitrate         Retr  Cwnd
[  5]   0.00-5.00   sec   813 MBytes   163 MBytes/sec   13   1.10 MBytes       
[  5]   5.00-10.01  sec   920 MBytes   184 MBytes/sec    0   1.28 MBytes       
[  5]  10.01-15.00  sec   766 MBytes   153 MBytes/sec    0   1.29 MBytes       
[  5]  15.00-20.01  sec   836 MBytes   167 MBytes/sec   11   1.10 MBytes       
[  5]  20.01-25.01  sec   804 MBytes   161 MBytes/sec    0   1.42 MBytes       
[  5]  25.01-30.01  sec   762 MBytes   152 MBytes/sec    0   1.50 MBytes  
```

报告显示了从本地主机（IP地址为192.168.235.145，端口号随机分配为55996）到远程主机（IP地址为192.168.235.147，端口号为5201）的网络性能测试结果。测试持续了30秒，并被分成了5个时间间隔，每个间隔5秒。下面是对每个时间间隔测试结果的简要解释：

1. 第一个时间间隔（0.00-5.00秒）：
   - 传输了813MB的数据。
   - 平均比特率为163MB/秒。
   - 有13次重传，表明在这段时间内网络可能遇到了一些小的拥塞或问题，导致数据包需要重传。
   - 拥塞窗口（Cwnd）大小为1.10MB，这是TCP拥塞控制机制中的一个重要参数，用于控制发送方在未收到确认之前可以发送的数据量。
2. 第二个时间间隔（5.00-10.01秒）：
   - 传输了920MB的数据。
   - 平均比特率提高到184MB/秒，表明网络状况可能有所改善。
   - 没有重传，表明网络传输在这段时间内较为稳定。
   - 拥塞窗口增加到1.28MB，以允许更多的数据在传输过程中被发送。
3. 第三个时间间隔（10.01-15.00秒）：
   - 传输了766MB的数据。
   - 平均比特率略有下降，为153MB/秒。
   - 同样没有重传，网络继续保持稳定。
   - 拥塞窗口保持在1.29MB左右。
4. 第四个时间间隔（15.00-20.01秒）：
   - 传输了836MB的数据。
   - 平均比特率回升至167MB/秒。
   - 有11次重传，可能由于网络中的短暂波动导致。
   - 拥塞窗口回落到1.10MB，以应对可能的拥塞情况。
5. 第五个时间间隔（20.01-25.01秒及25.01-30.01秒，但只显示了前者）：
   - 传输了804MB的数据。
   - 平均比特率为161MB/秒，与第四个间隔相近。
   - 没有重传，表明网络在这段时间内保持稳定。
   - 拥塞窗口增加到1.42MB，可能是因为网络状况良好，TCP尝试增加发送窗口以提高传输效率。

总的来说，这个测试显示了网络在大多数情况下能够提供稳定的带宽性能，但在某些时间段内可能会遇到轻微的拥塞或波动，这通过重传次数和拥塞窗口大小的变化可以观察到。



## 网络负载监控和分析